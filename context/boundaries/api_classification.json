{
  "api_classification": {
    "version": "1.1",
    "last_updated": "2025-01-04",
    "conversation_reference": "Codebase analysis of existing endpoint structure",
    
    "classification_principles": {
      "public_api_criteria": {
        "decision_id": "api_class_001",
        "content": "Public API endpoints serve external consumers and separate public website. Must be documented, versioned, and OAuth2 authenticated",
        "added_date": "2025-01-04",
        "characteristics": [
          "OAuth2 token authentication required",
          "Comprehensive OpenAPI documentation",
          "Versioned with beta/stable paths",
          "Read-only access for external consumers",
          "Designed for separate public website consumption"
        ],
        "confidence_level": "high",
        "status": "active"
      },
      
      "internal_api_criteria": {
        "decision_id": "api_class_002",
        "content": "Internal API endpoints serve Django template frontend and museum staff workflows. Session-based auth, not documented publicly",
        "added_date": "2025-01-04",
        "characteristics": [
          "Django session authentication",
          "Serve template-based frontend needs",
          "Support museum staff workflows",
          "Not included in public API documentation",
          "May include write operations for staff"
        ],
        "confidence_level": "high",
        "status": "active"
      }
    },
    
    "current_endpoint_mapping": {
      "public_api_endpoints": {
        "base_path": "/api/",
        "authentication": "OAuth2 token required",
        "documentation": "Available at /api/docs/ and /api/redoc/",
        "endpoints": {
          "items": {
            "paths": ["/api/beta/v1/items/", "/api/v1/items/"],
            "methods": ["GET"],
            "description": "Archive items with metadata",
            "permission_class": "IsAdminOrHasToken",
            "viewset": "ItemViewSet",
            "serializers": ["ItemListSerializer", "ItemDetailSerializer"],
            "openapi_documented": true
          },
          "collections": {
            "paths": ["/api/beta/v1/collections/", "/api/v1/collections/"],
            "methods": ["GET"],
            "description": "Archive collections",
            "permission_class": "IsAdminOrHasToken", 
            "viewset": "CollectionViewSet",
            "serializers": ["CollectionListSerializer", "CollectionDetailSerializer"],
            "openapi_documented": true
          },
          "languoids": {
            "paths": ["/api/beta/v1/languoids/", "/api/v1/languoids/"],
            "methods": ["GET"],
            "description": "Language/dialect information",
            "permission_class": "IsAdminOrHasToken",
            "viewset": "LanguoidViewSet", 
            "serializers": ["LanguoidListSerializer", "LanguoidDetailSerializer"],
            "openapi_documented": true
          },
          "collaborators": {
            "paths": ["/api/beta/v1/collaborators/", "/api/v1/collaborators/"],
            "methods": ["GET"],
            "description": "Collaborator information",
            "permission_class": "IsAdminOrHasToken",
            "viewset": "CollaboratorViewSet",
            "serializers": ["CollaboratorListSerializer", "CollaboratorDetailSerializer"],
            "openapi_documented": true
          },
          "map": {
            "paths": ["/api/v1/map/items/"],
            "methods": ["GET"],
            "description": "Geographic data for map visualization in GeoJSON format",
            "permission_class": "AllowAny",
            "viewset": "ItemMapViewSet",
            "serializers": ["ItemMapSerializer", "ItemMapFeatureCollectionSerializer"],
            "openapi_documented": true,
            "added_date": "2025-11-12",
            "features": {
              "format": "GeoJSON FeatureCollection (RFC 7946)",
              "required_params": ["bbox (west,south,east,north)"],
              "optional_params": ["zoom (0-20)", "collection (abbreviation)"],
              "filtering": "Database-level via FilterBackends (BoundingBoxFilterBackend, DensityFilterBackend, CollectionFilterBackend)",
              "title_source": "ItemTitle with default=True, fallback to catalog_number",
              "query_optimization": "select_related('collection'), prefetch_related('title_item')",
              "data_coverage": "2,307 items with coordinates (~52.5% of archive)"
            }
          }
        }
      },
      
      "internal_api_endpoints": {
        "base_paths": ["/api/", "/metadata/api/"],
        "authentication": "Django session (login_required)",
        "documentation": "Not publicly documented",
        "endpoints": {
          "item_migrate_api": {
            "path": "/api/item-update-migrate/<int:pk>/",
            "methods": ["PUT", "PATCH"],
            "description": "Item migration updates for staff",
            "view": "ItemUpdateMigrateView",
            "permission": "username == 'kavon' (temporary)",
            "purpose": "Data migration workflow for staff"
          },
          "languoids_list_internal": {
            "path": "/api/languoids/",
            "methods": ["GET"],
            "description": "Internal languoid listing for templates",
            "view": "LanguoidListView",
            "purpose": "Template dropdown population"
          },
          "item_files_api": {
            "path": "/metadata/api/items/<int:item_id>/files/",
            "methods": ["POST", "PUT"],
            "description": "File management for items",
            "view": "api_update_item_files",
            "purpose": "Template-based file operations"
          }
        }
      },
      
      "template_endpoints": {
        "authentication": "Django session (login_required)",
        "description": "Traditional Django views serving HTML templates",
        "categories": {
          "catalog_management": {
            "base_path": "/catalog/",
            "endpoints": ["item_index", "item_detail", "item_edit", "item_add", "item_delete"],
            "purpose": "Main catalog interface for museum staff"
          },
          "collections_management": {
            "base_path": "/collections/",
            "endpoints": ["collection_index", "collection_detail", "collection_edit", "collection_add", "collection_delete"],
            "purpose": "Collection management interface"
          },
          "collaborators_management": {
            "base_path": "/collaborators/",
            "endpoints": ["collaborator_index", "collaborator_detail", "collaborator_edit", "collaborator_add", "collaborator_delete"],
            "purpose": "Collaborator management interface"
          },
          "languoids_management": {
            "base_path": "/languoids/",
            "endpoints": ["languoid_index", "languoid_detail", "languoid_edit", "languoid_add", "languoid_delete", "languoid_stats"],
            "purpose": "Language/dialect management interface"
          },
          "documents_management": {
            "base_path": "/documents/",
            "endpoints": ["document_index", "document_detail", "document_edit", "document_add", "document_delete"],
            "purpose": "Legacy document management (transitioning to Files model)"
          },
          "import_export": {
            "paths": ["/catalog/import/", "/collaborators/import/", "/languoids/import/"],
            "endpoints": ["ImportView", "document_upload"],
            "purpose": "Data import workflows for staff"
          }
        }
      }
    },
    
    "api_versioning_strategy": {
      "frozen_stable_versions": {
        "decision_id": "api_class_003",
        "content": "Strategy A: Frozen stable versions (v1, v2, v3...) - each version is frozen and never changes",
        "added_date": "2025-01-04",
        "updated_date": "2025-11-12",
        "conversation_reference": "API versioning strategy discussion - removed beta, established frozen version approach",
        "implementation": "Single router for v1, version-specific schema endpoints",
        "current_structure": {
          "api_routes": "/api/v1/ - Only stable v1 exists currently",
          "schema_endpoints": [
            "/api/v1/schema/ - v1-specific schema",
            "/api/v1/docs/ - v1-specific Swagger UI",
            "/api/v1/redoc/ - v1-specific ReDoc"
          ],
          "latest_endpoints": [
            "/api/schema/ - Latest schema (currently v1)",
            "/api/docs/ - Latest Swagger UI (currently v1)",
            "/api/redoc/ - Latest ReDoc (currently v1)"
          ]
        },
        "beta_removed": {
          "date": "2025-11-12",
          "reason": "Beta was unused and added unnecessary complexity. For infrequent changes, frozen versions are more appropriate than rolling beta.",
          "cleanup": "Removed beta_router, beta endpoints, all beta references"
        },
        "future_evolution": {
          "v2_when_needed": "When breaking changes required, release v2 alongside v1",
          "migration_window": "Support both versions for 12-24 months",
          "deprecation_process": "Announce v1 deprecation, provide migration guide, maintain overlap period"
        },
        "change_frequency": "Infrequent (not continuous development)",
        "additive_changes_only": "v1 only receives additive changes (new fields, new endpoints) - no breaking changes",
        "confidence_level": "high",
        "status": "active",
        "cross_references": ["architectural_decisions.json", "documentation_structure.json"]
      }
    },
    
    "authentication_patterns": {
      "public_api_auth": {
        "method": "OAuth2 token",
        "permission_class": "IsAdminOrHasToken",
        "required_scopes": ["read"],
        "implementation": "oauth2_provider.contrib.rest_framework.TokenHasScope"
      },
      "internal_auth": {
        "method": "Django session",
        "decorators": ["@login_required", "@user_passes_test"],
        "permission_mixins": ["LoginRequiredMixin", "UserPassesTestMixin"]
      }
    },
    
    "documentation_strategy": {
      "public_documentation": {
        "tools": ["drf-spectacular", "OpenAPI 3.0"],
        "endpoints": [
          "/api/schema/ - Latest API schema",
          "/api/docs/ - Latest Swagger UI", 
          "/api/redoc/ - Latest ReDoc",
          "/api/v1/schema/ - v1-specific schema",
          "/api/v1/docs/ - v1-specific Swagger UI",
          "/api/v1/redoc/ - v1-specific ReDoc"
        ],
        "includes": "All public API endpoints with full OpenAPI specs",
        "organization": {
          "principle": "Group by resource type (items, collections, languoids, collaborators, map), NOT by version",
          "rationale": "Version is in URL, consumers care about 'what can I do' not 'what version am I using'",
          "implementation": "TAGS list in SPECTACULAR_SETTINGS organized by resource",
          "version_separation": "When v2 exists, separate schema/docs pages at /api/v1/docs and /api/v2/docs",
          "updated_date": "2025-11-12"
        },
        "internal_api_exclusion": {
          "mechanism": "PREPROCESSING_HOOKS with exclude_internal_api function",
          "implementation_file": "app/archive/spectacular_hooks.py",
          "excluded_paths": "Endpoints starting with /internal/",
          "rationale": "Internal API for React frontend should not appear in public API documentation"
        },
        "tags": [
          {"name": "items", "description": "Operations with archive items"},
          {"name": "collections", "description": "Operations with collections"},
          {"name": "languoids", "description": "Operations with languoids"},
          {"name": "collaborators", "description": "Operations with collaborators"},
          {"name": "map", "description": "Geographic data for map visualization"}
        ]
      },
      "internal_documentation": {
        "approach": "Code comments and context files only",
        "rationale": "Internal endpoints not meant for external consumption"
      },
      "consumer_facing_guide": {
        "location": "docs/api/map-endpoint-guide.md",
        "purpose": "Developer integration guide for map API consumers",
        "audience": "External developers integrating with the public API",
        "content": "Quick start, client-side integration examples (Leaflet, MapBox), performance best practices, error handling"
      }
    },
    
    "current_gaps_and_improvements": {
      "endpoint_streamlining": {
        "issue": "Some internal API endpoints may be redundant with public API",
        "example": "Both /api/languoids/ (internal) and /api/v1/languoids/ (public) exist",
        "improvement_needed": "Audit and potentially consolidate duplicate functionality"
      },
      "permission_refinement": {
        "issue": "Some internal endpoints have temporary permission restrictions",
        "example": "ItemUpdateMigrateView restricted to 'kavon' username",
        "improvement_needed": "Replace with proper role-based permissions"
      }
    }
  }
}