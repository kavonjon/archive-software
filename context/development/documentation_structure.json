{
  "documentation_structure": {
    "version": "2.0",
    "last_updated": "2025-11-03",
    "conversation_reference": "Updated user guide section with complete implementation details for in-app documentation system",
    
    "documentation_philosophy": {
      "decision_id": "docs_001",
      "content": "Documentation organized by audience and purpose, following industry conventions",
      "added_date": "2025-10-27",
      "principles": [
        "Deployment docs for operators and sysadmins",
        "Development docs for contributors and developers",
        "Operations docs for day-to-day maintenance",
        "README files co-located with relevant code/data"
      ],
      "confidence_level": "high",
      "status": "active"
    },
    
    "directory_structure": {
      "decision_id": "docs_002",
      "content": "Five-tier documentation structure under docs/ directory",
      "added_date": "2025-10-27",
      "updated_date": "2025-10-29",
      "structure": {
        "docs/": "Root documentation directory with index README",
        "docs/deployment/": "Deployment guides, setup procedures, infrastructure",
        "docs/development/": "Development environment, dependencies, contributing",
        "docs/operations/": "Day-to-day operations, maintenance, troubleshooting",
        "docs/user-guide/": "End-user documentation for museum staff, archivists, researchers using the system",
        "docs/system-behavior/": "Technical documentation of system logic, algorithms, and processing workflows"
      },
      "rationale": "Follows Django, Python, and DevOps documentation conventions for clarity and discoverability. Separates user-facing docs from technical/operational docs.",
      "confidence_level": "high",
      "status": "active"
    },
    
    "existing_documentation": {
      "decision_id": "docs_003",
      "content": "Inventory of current documentation files and their purposes",
      "added_date": "2025-10-27",
      "files": {
        "docs/README.md": {
          "purpose": "Documentation index and navigation hub",
          "audience": "All users - developers, operators, contributors",
          "content": "Overview, quick links, technology stack, architecture summary"
        },
        "docs/deployment/database-operations.md": {
          "purpose": "Complete guide for database backup and restore on TrueNAS Scale",
          "audience": "System administrators, operators",
          "content": "Dump procedures, transfer methods, restore script usage, troubleshooting",
          "related_scripts": ["deploy-restore-db-private.sh", "init-db.sh"]
        },
        "docs/development/dependencies.md": {
          "purpose": "Required software and packages for development",
          "audience": "Developers setting up local environment",
          "content": "Python, PostgreSQL, dependencies list"
        },
        "README.md": {
          "purpose": "Project overview and quick start",
          "audience": "First-time visitors, evaluators",
          "content": "Basic install instructions, warnings, Invenio setup (legacy)"
        },
        "backup/README.md": {
          "purpose": "Automated backup system documentation",
          "audience": "Operators, system administrators",
          "content": "Backup schedule, retention policy, monitoring",
          "location_rationale": "Co-located with backup directory for immediate reference"
        },
        "frontend/README.md": {
          "purpose": "React frontend documentation",
          "audience": "Frontend developers",
          "content": "Frontend-specific setup and development",
          "location_rationale": "Co-located with frontend code"
        },
        "archive/README.md": {
          "purpose": "Legacy Invenio documentation",
          "audience": "Historical reference",
          "content": "Invenio setup (legacy, inactive)",
          "status": "Legacy - Invenio component inactive"
        },
        "archive/app_data/README.md": {
          "purpose": "App data configuration documentation",
          "audience": "Developers working with vocabularies",
          "content": "Vocabularies configuration",
          "location_rationale": "Co-located with app data directory"
        }
      },
      "confidence_level": "high",
      "status": "active"
    },
    
    "documentation_conventions": {
      "decision_id": "docs_004",
      "content": "Naming and formatting conventions for documentation files",
      "added_date": "2025-10-27",
      "conventions": {
        "file_naming": "kebab-case for multi-word filenames (e.g., database-operations.md)",
        "directory_naming": "lowercase single words or kebab-case (e.g., deployment/, development/)",
        "readme_placement": "README.md in directories for directory-specific documentation",
        "detailed_guides": "Descriptive names in appropriate subdirectory (e.g., docs/deployment/database-operations.md)",
        "cross_references": "Use relative paths for internal links, absolute URLs for external"
      },
      "markdown_standards": {
        "headers": "# for title, ## for major sections, ### for subsections",
        "code_blocks": "Use triple backticks with language specification",
        "examples": "Provide concrete examples with real commands",
        "warnings": "Use visual indicators (‚ö†Ô∏è, üö®) for important warnings",
        "structure": "Include table of contents for docs > 200 lines"
      },
      "confidence_level": "high",
      "status": "active"
    },
    
    "planned_documentation": {
      "decision_id": "docs_005",
      "content": "Documentation to be created as project matures",
      "added_date": "2025-10-27",
      "high_priority": [
        "docs/deployment/truenas-scale-setup.md - Initial TrueNAS deployment walkthrough",
        "docs/deployment/update-procedures.md - Detailed code update guide with examples",
        "docs/development/setup.md - Complete local development environment setup",
        "docs/operations/troubleshooting.md - Common issues, error messages, solutions"
      ],
      "medium_priority": [
        "docs/development/architecture.md - Deep dive into system architecture",
        "docs/development/contributing.md - Contribution guidelines and workflow",
        "docs/operations/monitoring.md - Performance monitoring and health checks",
        "docs/operations/security.md - Security best practices and procedures"
      ],
      "low_priority": [
        "docs/api/endpoints.md - API endpoint documentation (if not auto-generated)",
        "docs/deployment/disaster-recovery.md - Disaster recovery procedures",
        "docs/operations/performance-tuning.md - Optimization techniques"
      ],
      "confidence_level": "medium",
      "status": "planned"
    },
    
    "documentation_maintenance": {
      "decision_id": "docs_006",
      "content": "Process for keeping documentation current and accurate",
      "added_date": "2025-10-27",
      "principles": [
        "Update documentation in same commit as code changes",
        "Date-stamp major documentation updates",
        "Review documentation quarterly for accuracy",
        "Cross-reference related documentation files"
      ],
      "review_schedule": {
        "deployment_docs": "After any infrastructure changes",
        "development_docs": "After major dependency updates or architecture changes",
        "operations_docs": "Quarterly or after operational procedure changes"
      },
      "confidence_level": "high",
      "status": "active"
    },
    
    "context_memory_relationship": {
      "decision_id": "docs_007",
      "content": "Relationship between context memory and user-facing documentation",
      "added_date": "2025-10-27",
      "distinction": {
        "context_memory": {
          "purpose": "AI assistant context and architectural decisions",
          "audience": "AI assistants, lead developers understanding project history",
          "format": "Structured JSON with decision tracking",
          "location": "context/",
          "update_frequency": "Continuously during development"
        },
        "user_documentation": {
          "purpose": "Human-readable guides and procedures",
          "audience": "Developers, operators, contributors, users",
          "format": "Markdown with examples and tutorials",
          "location": "docs/, README files",
          "update_frequency": "With code changes and procedure updates"
        }
      },
      "cross_references": "Context memory should reference relevant docs/ files for operational procedures",
      "confidence_level": "high",
      "status": "active"
    },
    
    "end_user_documentation_types": {
      "decision_id": "docs_008",
      "content": "Two distinct types of end-user documentation with different audiences and purposes",
      "added_date": "2025-10-29",
      "conversation_reference": "End-user documentation requirement integration",
      
      "user_guide": {
        "purpose": "Document all user actions and workflows for system users",
        "location": "docs/user-guide/",
        "audience": "Museum staff, archivists, researchers using the system",
        "focus": "HOW TO USE the system",
        "implementation_status": "Active - rendered in-app at /user-guide with contextual help links",
        
        "technical_implementation": {
          "architecture": "Single-page React component with markdown source files",
          "rendering": "ReactMarkdown with Material-UI styling",
          "navigation": "Sticky TOC sidebar with smooth scrolling to sections",
          "deep_linking": "Anchor links to specific sections (e.g., /user-guide#batch-editor)",
          "contextual_help": "InfoIconLink component places help icons throughout UI",
          "build_automation": "npm prestart/prebuild scripts copy markdown from docs/ to public/",
          "single_source_principle": "Markdown files in docs/user-guide/ are authoritative source",
          "implementation_reference": "stage_1_batch_editing.json::user_guide_system (decision stage1_064)"
        },
        
        "file_organization_principles": {
          "separation_by_edit_type": "Single-edit content separate from batch-edit content",
          "model_specific_structure": "Each model has top-level single-edit guide AND batch editor subsection",
          "common_vs_specific": "General features in overview, model-specific in subsections",
          "scalability": "Structure supports adding new models without reorganization",
          "naming_convention": "kebab-case (editing-languoids.md, languoid-batch.md)"
        },
        
        "content_organization": {
          "single_edit_guides": {
            "purpose": "Teach data model and individual record editing",
            "location": "docs/user-guide/editing-{model}.md",
            "structure": [
              "Data model overview (What is a {Model}?)",
              "Field descriptions with types and validation",
              "Relationships and hierarchies",
              "Validation rules",
              "Single-edit workflows (create, update)",
              "Common tasks"
            ],
            "example": "docs/user-guide/editing-languoids.md"
          },
          "batch_edit_guides": {
            "purpose": "Teach batch-specific features and bulk operations",
            "location": "docs/user-guide/batch-editor/{model}-batch.md",
            "structure": [
              "Batch-specific features (hierarchical display, bulk ops)",
              "Importing spreadsheets (recognized columns, ignored columns)",
              "Model-specific requirements (e.g., parent-child save order)",
              "Common batch tasks",
              "Validation in batch mode",
              "Performance tips"
            ],
            "example": "docs/user-guide/batch-editor/languoid-batch.md"
          },
          "general_batch_guide": {
            "purpose": "Universal batch editing features (keyboard nav, selection, validation)",
            "location": "docs/user-guide/batch-editor/overview.md"
          },
          "supplementary_guides": {
            "getting_started": "docs/user-guide/getting-started.md - Navigation, basic workflows",
            "importing_data": "docs/user-guide/batch-editor/importing-data.md - Formats, troubleshooting",
            "keyboard_shortcuts": "docs/user-guide/batch-editor/keyboard-shortcuts.md - Cross-platform reference"
          }
        },
        
        "current_implemented_sections": [
          "Getting Started (navigation, basic workflows)",
          "Editing Languoids (single-edit, all fields, validation rules)",
          "Batch Editor Overview (keyboard nav, selection, validation)",
          "Batch Editing Languoids (hierarchical display, import details)",
          "Importing Data (general import guide)",
          "Keyboard Shortcuts (complete reference)"
        ],
        
        "future_sections_to_add": [
          "Editing Items (single-edit workflows)",
          "Editing Collaborators (single-edit workflows)",
          "Batch Editing Items (batch-editor/item-batch.md)",
          "Batch Editing Collaborators (batch-editor/collaborator-batch.md)"
        ],
        
        "markdown_conventions": {
          "headings": {
            "h1": "Main section title (one per file, maps to section anchor ID)",
            "h2": "Major subsections (appear in TOC)",
            "h3": "Minor subsections (appear in TOC)",
            "principle": "Descriptive headings that work out of context (TOC shows them)"
          },
          "formatting": {
            "code_inline": "Use backticks for field names, values (e.g., `glottocode`, `Parent Languoid`)",
            "code_blocks": "Use for CSV examples, workflows, step-by-step instructions",
            "emphasis": "**Bold** for critical warnings, *italic* for UI elements",
            "lists": "Bullet points for features, numbered for sequential steps",
            "tables": "For field lists, keyboard shortcuts, comparisons"
          },
          "writing_style": {
            "voice": "Direct, instructional, friendly",
            "audience": "Museum staff with varying technical skill",
            "examples": "Always include concrete examples with real field names",
            "warnings": "Use ‚ö†Ô∏è or **Important** for critical information",
            "tips": "Use **Tip** or **Note** for helpful but optional info"
          }
        },
        
        "contextual_help_integration": {
          "component": "InfoIconLink (frontend/src/components/common/InfoIconLink.tsx)",
          "usage_pattern": "<InfoIconLink anchor=\"section-id\" tooltip=\"Description\" />",
          "placement_strategy": "Next to buttons/features needing explanation",
          "behavior": "Opens user guide in current tab at specific section",
          "current_integrations": [
            "TanStackSpreadsheetWrapper - next to Save button, links to #languoid-batch"
          ]
        },
        
        "maintenance_workflow": {
          "updating_existing": [
            "1. Edit markdown in docs/user-guide/",
            "2. Restart dev server (triggers prestart hook) or run npm start",
            "3. Refresh browser to see changes"
          ],
          "adding_new_model_documentation": [
            "1. Create docs/user-guide/editing-{model}.md (single-edit guide)",
            "2. Create docs/user-guide/batch-editor/{model}-batch.md (batch guide)",
            "3. Add both sections to UserGuidePage.tsx sections array",
            "4. Add InfoIconLink to model's batch editor wrapper component",
            "5. Document recognized/ignored columns for spreadsheet import"
          ],
          "testing_checklist": [
            "Test anchor links from InfoIconLink components",
            "Verify TOC generates correctly with new sections",
            "Check mobile view (TOC should hide)",
            "Test scroll behavior with hash in URL",
            "Verify markdown renders correctly (code blocks, tables)"
          ]
        },
        
        "build_automation": {
          "package_json_hooks": {
            "prestart": "mkdir -p public/docs && cp -r ../docs/user-guide public/docs/",
            "prebuild": "mkdir -p public/docs && cp -r ../docs/user-guide public/docs/"
          },
          "gitignore": "frontend/public/docs/ (build artifact, not version controlled)",
          "principle": "Markdown in docs/ is source of truth, public/docs/ is generated",
          "cra_constraint": "Create React App cannot import files outside src/, must fetch from public/"
        },
        
        "model_specific_import_documentation_requirements": {
          "critical_details_to_document": [
            "Recognized columns (editable in batch editor)",
            "Ignored columns (calculated/derivative fields)",
            "Special column requirements (e.g., glottocode vs name)",
            "Parent-child save order for hierarchical data",
            "Mixed hierarchy support",
            "Update vs create behavior (matching logic)"
          ],
          "example": "languoid-batch.md documents that 'Parent Languoid Glottocode' is read, but 'Parent Languoid' (name) is ignored"
        },
        
        "react_implementation_details": {
          "main_component": "frontend/src/pages/UserGuidePage.tsx",
          "features": [
            "Fetches markdown files at page load",
            "Stores sections with IDs for anchors",
            "ReactMarkdown with custom Material-UI components",
            "Auto-generates TOC from headings",
            "Smooth scroll with retry logic (400ms + retry)",
            "scrollMarginTop: 80px for sticky nav clearance"
          ],
          "scroll_behavior": "Retry mechanism ensures content rendered before scrolling"
        },
        
        "design_decisions": {
          "single_page_design": "Better UX for Ctrl+F search, no page loads",
          "markdown_format": "Easy to edit, version controlled, non-technical can contribute",
          "automated_copy": "Maintains DRY principle within CRA constraints",
          "separate_files": "Maintainable sizes, clear ownership, parallel editing"
        },
        
        "known_limitations": {
          "no_builtin_search": "Users must use browser Ctrl+F",
          "no_version_history_ui": "Use git for history",
          "cra_public_requirement": "Must copy to public/, won't work if not copied",
          "no_images_yet": "Image support not implemented (would need public/docs/)"
        },
        
        "status": "active",
        "creation_trigger": "Implemented during Stage 1 batch editor development",
        "confidence_level": "high"
      },
      
      "system_behavior_documentation": {
        "purpose": "Document system logic and behavior at technical-conceptual level",
        "location": "docs/system-behavior/",
        "audience": "Technical users, sysadmins, developers understanding system internals",
        "focus": "HOW THE SYSTEM WORKS internally",
        "content_organization": {
          "by_component": "One file per major system component (e.g., 'Languoid Hierarchy', 'Permission System')",
          "by_process": "End-to-end workflows (e.g., 'File Ingestion Pipeline', 'Database Sync Process')",
          "by_algorithm": "Complex logic descriptions (e.g., 'Hierarchy Derivation', 'Access Control Rules')"
        },
        "required_sections": [
          "Languoid Hierarchy System (field derivation, signals, tasks)",
          "Permission and Access Control Logic",
          "File Processing Pipeline",
          "Database Synchronization Rules",
          "Cache Invalidation and Refresh Behavior",
          "Batch Editing Validation Logic",
          "Search and Filtering Implementation",
          "Export Generation Process",
          "Celery Task Processing Workflows",
          "Signal and Post-Save Operations"
        ],
        "formatting_requirements": {
          "pseudocode": "Use pseudocode-level descriptions (not actual code)",
          "state_transitions": "Clear diagrams or descriptions of state changes",
          "data_flow": "Describe data transformations and movements",
          "assumptions": "Explicit statements of assumptions and constraints",
          "edge_cases": "Document edge cases and error handling",
          "cross_references": "Link to code files for implementation details"
        },
        "example_structure": "## Languoid Parent Change: Descendents Update\n\n**What happens:** When a languoid's parent changes, the system must update the `descendents` M2M field for both old and new ancestor chains.\n\n**Steps:**\n1. pre_save signal detects parent change, stores old_parent_id\n2. post_save signal passes old_parent_id to async task\n3. Celery task:\n   - Updates NEW parent chain (adds moved subtree)\n   - Updates OLD parent chain (removes moved subtree)\n\n**Implementation:** See `app/metadata/signals.py` and `app/metadata/tasks.py`",
        "style_note": "Similar to architectural clarifications provided during development discussions",
        "status": "planned",
        "creation_trigger": "PM explicitly requests system behavior documentation"
      },
      
      "creation_and_maintenance_protocol": {
        "never_proactive": "Documentation is NEVER created automatically - PM must explicitly request it",
        "explicit_trigger_required": "PM must say 'create user documentation' or 'document system behavior for X'",
        "survey_mechanism": "PM can request documentation surveys to identify outdated/missing sections",
        "survey_does_not_update": "Surveys only report issues - PM must approve updates explicitly",
        "integration_with_development": "When implementing features, AI may FLAG that docs might need updates, but NEVER creates docs automatically",
        "cross_reference": "See protocol.json::end_user_documentation_protocol for complete workflow"
      },
      
      "distinction_from_other_docs": {
        "vs_developer_docs": "Developer docs (docs/development/) are for code contributors. User guide is for system users. System behavior is for understanding internals without diving into code.",
        "vs_deployment_docs": "Deployment docs (docs/deployment/) are for infrastructure setup. End-user docs assume system is running.",
        "vs_operations_docs": "Operations docs (docs/operations/) are for system maintenance. System behavior docs explain application logic, not infrastructure.",
        "vs_context_memory": "Context memory tracks AI decision history. End-user docs are polished deliverables for humans."
      },
      
      "confidence_level": "high",
      "status": "active",
      "cross_references": ["project_requirements.json::end_user_documentation", "protocol.json::end_user_documentation_protocol"]
    }
  }
}

